

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Storage Layer &mdash; ProtoBase 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data Structures" href="data_structures.html" />
    <link rel="prev" title="Core Components" href="core.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ProtoBase
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="core.html">Core Components</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Storage Layer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#memory-storage">Memory Storage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.memory_storage.MemoryStorage"><code class="docutils literal notranslate"><span class="pre">MemoryStorage</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#standalone-file-storage">Standalone File Storage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.standalone_file_storage.StandaloneFileStorage"><code class="docutils literal notranslate"><span class="pre">StandaloneFileStorage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.standalone_file_storage.WALState"><code class="docutils literal notranslate"><span class="pre">WALState</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.standalone_file_storage.WALWriteOperation"><code class="docutils literal notranslate"><span class="pre">WALWriteOperation</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#file-block-provider">File Block Provider</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.file_block_provider.FileBlockProvider"><code class="docutils literal notranslate"><span class="pre">FileBlockProvider</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cluster-file-storage">Cluster File Storage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.cluster_file_storage.ClusterFileStorage"><code class="docutils literal notranslate"><span class="pre">ClusterFileStorage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.cluster_file_storage.ClusterNetworkManager"><code class="docutils literal notranslate"><span class="pre">ClusterNetworkManager</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cloud-file-storage">Cloud File Storage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.cloud_file_storage.CloudFileStorage"><code class="docutils literal notranslate"><span class="pre">CloudFileStorage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.cloud_file_storage.CloudBlockProvider"><code class="docutils literal notranslate"><span class="pre">CloudBlockProvider</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.cloud_file_storage.S3Client"><code class="docutils literal notranslate"><span class="pre">S3Client</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.cloud_file_storage.MockS3Client"><code class="docutils literal notranslate"><span class="pre">MockS3Client</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.cloud_file_storage.S3ObjectMetadata"><code class="docutils literal notranslate"><span class="pre">S3ObjectMetadata</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#proto_db.cloud_file_storage.CloudStorageError"><code class="docutils literal notranslate"><span class="pre">CloudStorageError</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data_structures.html">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="queries.html">Query System</a></li>
<li class="toctree-l2"><a class="reference internal" href="exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="fsm.html">Finite State Machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#core-components">Core Components</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#storage-layer">Storage Layer</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Storage Layer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#memory-storage">Memory Storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#standalone-file-storage">Standalone File Storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#file-block-provider">File Block Provider</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cluster-file-storage">Cluster File Storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cloud-file-storage">Cloud File Storage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-structures">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#query-system">Query System</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#exceptions">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#finite-state-machine">Finite State Machine</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ProtoBase</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">API Reference</a></li>
      <li class="breadcrumb-item active">Storage Layer</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/storage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="storage-layer">
<h1>Storage Layer<a class="headerlink" href="#storage-layer" title="Link to this heading"></a></h1>
<p>This module provides the storage layer of ProtoBase, which is responsible for persisting data to disk, memory, or cloud storage.</p>
<section id="memory-storage">
<h2>Memory Storage<a class="headerlink" href="#memory-storage" title="Link to this heading"></a></h2>
<dl class="py class" id="module-proto_db.memory_storage">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.memory_storage.</span></span><span class="sig-name descname"><span class="pre">MemoryStorage</span></span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage" title="Link to this definition"></a></dt>
<dd><p>A simple in-memory implementation of a storage system.
This acts as a lightweight and temporary alternative to persistent storage,
ideal for testing and simulation purposes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage.__init__" title="Link to this definition"></a></dt>
<dd><p>Initializes the in-memory storage. It sets up:
- A unique transaction ID for all operations during this session.
- An empty atom dictionary for storing atoms against their offsets.
- A lock to make the memory storage thread-safe.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage.read_current_root">
<span class="sig-name descname"><span class="pre">read_current_root</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage.read_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage.read_current_root" title="Link to this definition"></a></dt>
<dd><p>Retrieve the current root object of the storage.
:return: The <cite>RootObject</cite>, if it exists.
:raises:</p>
<blockquote>
<div><p>ProtoValidationException: If no root object has been set yet.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage.read_lock_current_root">
<span class="sig-name descname"><span class="pre">read_lock_current_root</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage.read_lock_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage.read_lock_current_root" title="Link to this definition"></a></dt>
<dd><p>Read the current root object
:return:</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage.set_current_root">
<span class="sig-name descname"><span class="pre">set_current_root</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_root_history_pointer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage.set_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage.set_current_root" title="Link to this definition"></a></dt>
<dd><p>Set a new root history object for the storage, replacing any existing one.
:param new_root_history_pointer: The pointer to the new <cite>RootObject</cite> to be set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>new_root_history_pointer</strong> (<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage.unlock_current_root">
<span class="sig-name descname"><span class="pre">unlock_current_root</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage.unlock_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage.unlock_current_root" title="Link to this definition"></a></dt>
<dd><p>Unlock the current root by performing necessary operations based
on the implementation. This method typically interacts with the state or
systems associated with this object to achieve the unlocking process.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage.flush_wal">
<span class="sig-name descname"><span class="pre">flush_wal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage.flush_wal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage.flush_wal" title="Link to this definition"></a></dt>
<dd><p>No data to be flushed for memory storage
:return:</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage.push_atom">
<span class="sig-name descname"><span class="pre">push_atom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">atom</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage.push_atom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage.push_atom" title="Link to this definition"></a></dt>
<dd><p>Save an atom in the in-memory storage. Each atom gets a unique offset and is tied
to the current transaction ID.
:param atom: The <cite>Atom</cite> object to be stored.
:return: A <cite>Future</cite> containing the corresponding <cite>AtomPointer</cite> of the stored atom.
:raises:</p>
<blockquote>
<div><p>ProtoCorruptionException: If an atom with the same offset already exists.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>atom</strong> (<em>dict</em>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Future</em>[<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage.get_atom">
<span class="sig-name descname"><span class="pre">get_atom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">atom_pointer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage.get_atom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage.get_atom" title="Link to this definition"></a></dt>
<dd><p>Retrieve an atom from the storage using its atom pointer.
:param atom_pointer: The <cite>AtomPointer</cite> associated with the atom.
:return: A <cite>Future</cite> object containing the retrieved <cite>Atom</cite> as a dict.
:raises:</p>
<blockquote>
<div><p>ProtoCorruptionException: If the atom does not exist in the storage.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>atom_pointer</strong> (<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a>)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Future</em>[dict]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage.get_bytes">
<span class="sig-name descname"><span class="pre">get_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">atom_pointer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage.get_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage.get_bytes" title="Link to this definition"></a></dt>
<dd><p>Retrieves the byte data associated with the given atom pointer.</p>
<p>This method is used to asynchronously fetch and return the byte data
corresponding to the <cite>AtomPointer</cite> provided. It must be implemented
by any subclass as it is declared abstract.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>atom_pointer</strong> (<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a>) – Pointer to the atom whose byte data is to be
retrieved.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A future holding the byte data corresponding to
the atom pointer.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Future[bytes]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage.push_bytes">
<span class="sig-name descname"><span class="pre">push_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage.push_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage.push_bytes" title="Link to this definition"></a></dt>
<dd><p>Pushes a sequence of bytes to the underlying data structure or processing unit.</p>
<p>This method is abstract and must be implemented by subclasses. The concrete
implementation should handle the provided byte sequence according to its
specific requirements and behavior.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<em>bytes</em>) – A sequence of bytes to be processed or stored.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Future</em>[<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.memory_storage.MemoryStorage.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/memory_storage.html#MemoryStorage.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.memory_storage.MemoryStorage.close" title="Link to this definition"></a></dt>
<dd><p>Close the storage operation. This flushes any pending data and marks
the storage as closed. Further operations should not be allowed.
For the in-memory storage, this method does not perform any operations.</p>
</dd></dl>

</dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">MemoryStorage</span></code> is an in-memory storage implementation. It stores Atoms in memory, does not persist data across process restarts, and is useful for testing and development.</p>
</section>
<section id="standalone-file-storage">
<h2>Standalone File Storage<a class="headerlink" href="#standalone-file-storage" title="Link to this heading"></a></h2>
<dl class="py class" id="module-proto_db.standalone_file_storage">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.standalone_file_storage.</span></span><span class="sig-name descname"><span class="pre">StandaloneFileStorage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block_provider</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1048576</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blob_max_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2147483648</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">60</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage" title="Link to this definition"></a></dt>
<dd><p>An implementation of standalone file storage with support for Write-Ahead Logging (WAL).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>block_provider</strong> (<a class="reference internal" href="core.html#proto_db.common.BlockProvider" title="proto_db.common.BlockProvider"><em>BlockProvider</em></a>)</p></li>
<li><p><strong>buffer_size</strong> (<em>int</em>)</p></li>
<li><p><strong>blob_max_size</strong> (<em>int</em>)</p></li>
<li><p><strong>max_workers</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block_provider</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1048576</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blob_max_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2147483648</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">60</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.__init__" title="Link to this definition"></a></dt>
<dd><p>Constructor for the StandaloneFileStorage class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>block_provider</strong> (<a class="reference internal" href="core.html#proto_db.common.BlockProvider" title="proto_db.common.BlockProvider"><em>BlockProvider</em></a>) – The underlying storage provider</p></li>
<li><p><strong>buffer_size</strong> (<em>int</em>) – Size of the WAL buffer in bytes</p></li>
<li><p><strong>blob_max_size</strong> (<em>int</em>) – Maximum size of a blob in bytes</p></li>
<li><p><strong>max_workers</strong> (<em>int</em>) – Number of worker threads for asynchronous operations</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.read_current_root">
<span class="sig-name descname"><span class="pre">read_current_root</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.read_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.read_current_root" title="Link to this definition"></a></dt>
<dd><p>Read the current root object
:return:</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.read_lock_current_root">
<span class="sig-name descname"><span class="pre">read_lock_current_root</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.read_lock_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.read_lock_current_root" title="Link to this definition"></a></dt>
<dd><p>Read the current root object
In this provider, there is no difference with
a simple root reading
:return:</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.set_current_root">
<span class="sig-name descname"><span class="pre">set_current_root</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">root_pointer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.set_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.set_current_root" title="Link to this definition"></a></dt>
<dd><p>Set the current root object
:return:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>root_pointer</strong> (<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.unlock_current_root">
<span class="sig-name descname"><span class="pre">unlock_current_root</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.unlock_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.unlock_current_root" title="Link to this definition"></a></dt>
<dd><p>Abort root update process
Nothing to do for this provider
:return:</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.flush_wal">
<span class="sig-name descname"><span class="pre">flush_wal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.flush_wal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.flush_wal" title="Link to this definition"></a></dt>
<dd><p>Public method to flush WAL buffer and process pending writes.</p>
<p>This method ensures that all data in the current WAL buffer is written to
the pending writes list and then processes all pending writes by writing
them to the underlying block provider.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A tuple containing (bytes_flushed, operations_processed)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tuple</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="exceptions.html#proto_db.exceptions.ProtoUnexpectedException" title="proto_db.exceptions.ProtoUnexpectedException"><strong>ProtoUnexpectedException</strong></a> – If an error occurs during the flushing process</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.close" title="Link to this definition"></a></dt>
<dd><p>Closes the storage, flushing any pending writes and releasing resources.</p>
<p>This method changes the storage state to ‘Closed’, flushes the WAL buffer,
closes the underlying block provider, and shuts down the executor pool.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.push_bytes_to_wal">
<span class="sig-name descname"><span class="pre">push_bytes_to_wal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.push_bytes_to_wal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.push_bytes_to_wal" title="Link to this definition"></a></dt>
<dd><p>Adds data to the Write-Ahead Log (WAL).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> – The bytes or bytearray to be written to the WAL</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing the transaction ID (UUID) and the offset where the data was written</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="exceptions.html#proto_db.exceptions.ProtoValidationException" title="proto_db.exceptions.ProtoValidationException"><strong>ProtoValidationException</strong></a> – If data is not bytes or bytearray, is empty, exceeds maximum size,
    or if the storage is not in ‘Running’ state</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tuple[<em>UUID</em>, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.get_atom">
<span class="sig-name descname"><span class="pre">get_atom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pointer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.get_atom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.get_atom" title="Link to this definition"></a></dt>
<dd><p>Retrieves an Atom from the underlying storage asynchronously.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pointer</strong> (<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a>) – An AtomPointer indicating the location of the atom</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A Future that resolves to the atom data</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Future[dict]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="exceptions.html#proto_db.exceptions.ProtoValidationException" title="proto_db.exceptions.ProtoValidationException"><strong>ProtoValidationException</strong></a> – If pointer is not an AtomPointer or if storage is closed</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.push_atom">
<span class="sig-name descname"><span class="pre">push_atom</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">atom</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.push_atom"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.push_atom" title="Link to this definition"></a></dt>
<dd><p>Serializes and pushes an Atom into the WAL asynchronously.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>atom</strong> (<em>dict</em>) – The atom data to be stored</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A Future that resolves to an AtomPointer indicating</dt><dd><p>the location where the atom was stored</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Future[<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer">AtomPointer</a>]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="exceptions.html#proto_db.exceptions.ProtoValidationException" title="proto_db.exceptions.ProtoValidationException"><strong>ProtoValidationException</strong></a> – If the storage is not in ‘Running’ state</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.get_bytes">
<span class="sig-name descname"><span class="pre">get_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pointer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.get_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.get_bytes" title="Link to this definition"></a></dt>
<dd><p>Retrieves raw bytes from the underlying storage asynchronously.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pointer</strong> (<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a>) – An AtomPointer indicating the location of the data</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A Future that resolves to the raw bytes</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Future[bytes]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="exceptions.html#proto_db.exceptions.ProtoValidationException" title="proto_db.exceptions.ProtoValidationException"><strong>ProtoValidationException</strong></a> – If pointer is not an AtomPointer or if storage is closed</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.StandaloneFileStorage.push_bytes">
<span class="sig-name descname"><span class="pre">push_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#StandaloneFileStorage.push_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.StandaloneFileStorage.push_bytes" title="Link to this definition"></a></dt>
<dd><p>Serializes and pushes raw bytes into the WAL asynchronously.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<em>bytes</em>) – The bytes to be stored</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A Future that resolves to a tuple containing</dt><dd><p>the transaction ID and offset where the data was stored</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Future[tuple[uuid.UUID, int]]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="exceptions.html#proto_db.exceptions.ProtoValidationException" title="proto_db.exceptions.ProtoValidationException"><strong>ProtoValidationException</strong></a> – If data is not bytes, is empty, exceeds maximum size,
    or if the storage is not in ‘Running’ state</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">StandaloneFileStorage</span></code> is a file-based storage implementation. It stores Atoms in files on disk, uses Write-Ahead Logging (WAL) for durability, and provides persistence across process restarts.</p>
<dl class="py class">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.WALState">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.standalone_file_storage.</span></span><span class="sig-name descname"><span class="pre">WALState</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wal_buffer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wal_offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wal_base</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#WALState"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.WALState" title="Link to this definition"></a></dt>
<dd><p>A class encapsulating the current WAL (Write-Ahead Log) state for easier manipulation.</p>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.WALState.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wal_buffer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wal_offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wal_base</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#WALState.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.WALState.__init__" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">WALState</span></code> class represents the state of a Write-Ahead Log (WAL). It tracks the current position, base, and other metadata.</p>
<dl class="py class">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.WALWriteOperation">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.standalone_file_storage.</span></span><span class="sig-name descname"><span class="pre">WALWriteOperation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segments</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#WALWriteOperation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.WALWriteOperation" title="Link to this definition"></a></dt>
<dd><p>Represents a single WAL write operation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transaction_id</strong> (<em>uuid.UUID</em>)</p></li>
<li><p><strong>offset</strong> (<em>int</em>)</p></li>
<li><p><strong>segments</strong> (<em>list</em><em>[</em><em>bytearray</em><em>]</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.standalone_file_storage.WALWriteOperation.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segments</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/standalone_file_storage.html#WALWriteOperation.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.standalone_file_storage.WALWriteOperation.__init__" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transaction_id</strong> (<em>UUID</em>)</p></li>
<li><p><strong>offset</strong> (<em>int</em>)</p></li>
<li><p><strong>segments</strong> (<em>list</em><em>[</em><em>bytearray</em><em>]</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">WALWriteOperation</span></code> class represents a write operation in the WAL. It contains the transaction ID, offset, and segments to be written.</p>
</section>
<section id="file-block-provider">
<h2>File Block Provider<a class="headerlink" href="#file-block-provider" title="Link to this heading"></a></h2>
<dl class="py class" id="module-proto_db.file_block_provider">
<dt class="sig sig-object py" id="proto_db.file_block_provider.FileBlockProvider">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.file_block_provider.</span></span><span class="sig-name descname"><span class="pre">FileBlockProvider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">space_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maximun_cache_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">page_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1048576</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/file_block_provider.html#FileBlockProvider"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.file_block_provider.FileBlockProvider" title="Link to this definition"></a></dt>
<dd><p>Shared File Block Provider.</p>
<p>This class defines a block storage provider that uses a shared file space, represented by a directory
accessible for read/write operations by multiple processes. These processes can run either on the same
machine or on different machines sharing the same space.</p>
<p>### Functionality Description</p>
<ul>
<li><p><strong>Shared Space:</strong>
The storage block is defined within a directory (space directory), which must be accessible for all
storage operations. Synchronization between processes is exclusively managed through common file
operations provided by the underlying operating system.</p></li>
<li><p><strong>Root Object:</strong>
The root object of the system will be managed outside the scope of this class. However, within the
space directory, two fixed-name files are expected to be present at all times:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>space.config</cite>: A configuration file containing global information for all processes.</p></li>
<li><p><cite>space_root</cite>: A JSON file containing the last saved root object. This file can be updated by one
process through exclusive write access. The new root value will be written in JSON format,
UTF-8 encoded, and the file will then be closed.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>WAL Files (Write-Ahead Logs):</strong>
Within the space, there will also be 1 to N WAL files. Each process will take exclusive write access
to one of these WAL files (the WAL assigned to the process), while other processes may access it for
simultaneous read operations. WALs that are not assigned to any process can be accessed freely for
concurrent reads by any process.</p></li>
<li><p><strong>Buffered Writes:</strong>
In certain cases, a recently written operation may have been committed to a process’s own WAL but may
not yet be accessible to other processes due to buffered writes. It is the responsibility of the
storage system to handle such cases, serving read requests from the same process via buffered data
or exposing the data to other processes, potentially via a network connection. This is beyond the
responsibility of the block provider.</p></li>
<li><p><strong>WAL Maximum Size:</strong>
WALs can grow up to a predefined maximum size. When this limit is reached, any pending operations
must be flushed, and the old WAL should be closed through the <cite>close_wal</cite> method. Afterward, a new
WAL can be created or selected using <cite>get_new_wal</cite>. This ensures that each process will sequentially
use multiple WALs. Additionally, this mechanism aids in backup management, as individual WAL files
will remain within manageable size limits.</p></li>
<li><p><strong>Space Growth:</strong>
The space directory will grow dynamically with as many WAL files as needed to store all recorded
data. Each WAL will be named using a unique identifier (a <cite>uuid4</cite> hex identifier).</p></li>
</ul>
<p>### Common Operations</p>
<ul class="simple">
<li><p><strong>Reading:</strong>
A single WAL file can support multiple simultaneous readers, each with its own independent cursor
position. Seek operations are allowed for readers.</p></li>
<li><p><strong>Writing:</strong>
Write operations will primarily be sequential. However, in cases of retries following exceptions,
a seek operation may be performed to retry the failed operation.</p></li>
</ul>
<p>### Thread Safety
All code implemented within this class is thread-safe.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>space_path</strong> (<em>str</em>)</p></li>
<li><p><strong>maximun_cache_size</strong> (<em>int</em>)</p></li>
<li><p><strong>page_size</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.file_block_provider.FileBlockProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">space_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maximun_cache_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">page_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1048576</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/file_block_provider.html#FileBlockProvider.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.file_block_provider.FileBlockProvider.__init__" title="Link to this definition"></a></dt>
<dd><p>Constructor for the FileBlockProvider class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>space_path</strong> (<em>str</em>) – shared directory to use for the space. if not given, current directory is used</p></li>
<li><p><strong>maximun_cache_size</strong> (<em>int</em>) – requested cache size. If no value is provided a default value
of 50% of physical memory will be used</p></li>
<li><p><strong>page_size</strong> (<em>int</em>) – page_size to use. if not given, then DEFAULT_PAGE_SIZE</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.file_block_provider.FileBlockProvider.get_config_data">
<span class="sig-name descname"><span class="pre">get_config_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/file_block_provider.html#FileBlockProvider.get_config_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.file_block_provider.FileBlockProvider.get_config_data" title="Link to this definition"></a></dt>
<dd><p>Get config data
:return:</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.file_block_provider.FileBlockProvider.get_new_wal">
<span class="sig-name descname"><span class="pre">get_new_wal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/file_block_provider.html#FileBlockProvider.get_new_wal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.file_block_provider.FileBlockProvider.get_new_wal" title="Link to this definition"></a></dt>
<dd><p>Get a WAL to use.
It could be an old one, or a new one.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a tuple with the id of the WAL and the next offset to use</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tuple[<em>UUID</em>, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.file_block_provider.FileBlockProvider.get_reader">
<span class="sig-name descname"><span class="pre">get_reader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wal_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/file_block_provider.html#FileBlockProvider.get_reader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.file_block_provider.FileBlockProvider.get_reader" title="Link to this definition"></a></dt>
<dd><p>Get a streamer initialized at position in WAL file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wal_id</strong> (<em>UUID</em>)</p></li>
<li><p><strong>position</strong> (<em>int</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>BinaryIO</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.file_block_provider.FileBlockProvider.get_writer_wal">
<span class="sig-name descname"><span class="pre">get_writer_wal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/file_block_provider.html#FileBlockProvider.get_writer_wal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.file_block_provider.FileBlockProvider.get_writer_wal" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p></p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>UUID</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.file_block_provider.FileBlockProvider.write_streamer">
<span class="sig-name descname"><span class="pre">write_streamer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wal_id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/file_block_provider.html#FileBlockProvider.write_streamer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.file_block_provider.FileBlockProvider.write_streamer" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>wal_id</strong> (<em>UUID</em>)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>BinaryIO</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.file_block_provider.FileBlockProvider.get_current_root_object">
<span class="sig-name descname"><span class="pre">get_current_root_object</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/file_block_provider.html#FileBlockProvider.get_current_root_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.file_block_provider.FileBlockProvider.get_current_root_object" title="Link to this definition"></a></dt>
<dd><p>Read current root object from storage
:return: the current root object</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.file_block_provider.FileBlockProvider.update_root_object">
<span class="sig-name descname"><span class="pre">update_root_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_root</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/file_block_provider.html#FileBlockProvider.update_root_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.file_block_provider.FileBlockProvider.update_root_object" title="Link to this definition"></a></dt>
<dd><p>Updates or create the root object in storage
On newly created databases, this is the first
operation to perform</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>new_root</strong> (<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a>)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.file_block_provider.FileBlockProvider.close_wal">
<span class="sig-name descname"><span class="pre">close_wal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/file_block_provider.html#FileBlockProvider.close_wal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.file_block_provider.FileBlockProvider.close_wal" title="Link to this definition"></a></dt>
<dd><p>Close a previous WAL. Flush any pending data. Make all changes durable
:return:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>transaction_id</strong> (<em>UUID</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.file_block_provider.FileBlockProvider.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/file_block_provider.html#FileBlockProvider.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.file_block_provider.FileBlockProvider.close" title="Link to this definition"></a></dt>
<dd><p>Close the operation of the block provider. Flush any pending data to WAL. Make all changes durable
No further operations are allowed
:return:</p>
</dd></dl>

</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">FileBlockProvider</span></code> class is a block provider implementation that uses files on disk for storage. It is used by <code class="docutils literal notranslate"><span class="pre">StandaloneFileStorage</span></code> to read and write blocks.</p>
</section>
<section id="cluster-file-storage">
<h2>Cluster File Storage<a class="headerlink" href="#cluster-file-storage" title="Link to this heading"></a></h2>
<dl class="py class" id="module-proto_db.cluster_file_storage">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterFileStorage">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.cluster_file_storage.</span></span><span class="sig-name descname"><span class="pre">ClusterFileStorage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block_provider</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">server_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">host</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">servers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vote_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_interval_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_retries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1048576</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blob_max_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2147483648</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">60</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterFileStorage"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterFileStorage" title="Link to this definition"></a></dt>
<dd><p>An implementation of cluster file storage with support for distributed operations.</p>
<p>This class extends StandaloneFileStorage to add support for distributed operations
in a cluster environment, including vote-based exclusive locking, root synchronization,
and cached page retrieval between servers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>block_provider</strong> (<a class="reference internal" href="core.html#proto_db.common.BlockProvider" title="proto_db.common.BlockProvider"><em>BlockProvider</em></a>)</p></li>
<li><p><strong>server_id</strong> (<em>str</em>)</p></li>
<li><p><strong>host</strong> (<em>str</em>)</p></li>
<li><p><strong>port</strong> (<em>int</em>)</p></li>
<li><p><strong>servers</strong> (<a class="reference internal" href="data_structures.html#proto_db.lists.List" title="proto_db.lists.List"><em>List</em></a><em>[</em><em>Tuple</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em><em>]</em>)</p></li>
<li><p><strong>vote_timeout_ms</strong> (<em>int</em>)</p></li>
<li><p><strong>read_timeout_ms</strong> (<em>int</em>)</p></li>
<li><p><strong>retry_interval_ms</strong> (<em>int</em>)</p></li>
<li><p><strong>max_retries</strong> (<em>int</em>)</p></li>
<li><p><strong>buffer_size</strong> (<em>int</em>)</p></li>
<li><p><strong>blob_max_size</strong> (<em>int</em>)</p></li>
<li><p><strong>max_workers</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterFileStorage.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block_provider</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">server_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">host</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">servers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vote_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_interval_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_retries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1048576</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blob_max_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2147483648</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">60</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterFileStorage.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterFileStorage.__init__" title="Link to this definition"></a></dt>
<dd><p>Constructor for the ClusterFileStorage class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>block_provider</strong> (<a class="reference internal" href="core.html#proto_db.common.BlockProvider" title="proto_db.common.BlockProvider"><em>BlockProvider</em></a>) – The underlying storage provider</p></li>
<li><p><strong>server_id</strong> (<em>str</em>) – Unique identifier for this server (defaults to a UUID)</p></li>
<li><p><strong>host</strong> (<em>str</em>) – Host address to bind to</p></li>
<li><p><strong>port</strong> (<em>int</em>) – Port to listen on</p></li>
<li><p><strong>servers</strong> (<em>List</em><em>[</em><em>Tuple</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em><em>]</em>) – List of (host, port) tuples for all servers in the cluster</p></li>
<li><p><strong>vote_timeout_ms</strong> (<em>int</em>) – Timeout for vote requests in milliseconds</p></li>
<li><p><strong>read_timeout_ms</strong> (<em>int</em>) – Timeout for page requests in milliseconds</p></li>
<li><p><strong>retry_interval_ms</strong> (<em>int</em>) – Interval between retries in milliseconds</p></li>
<li><p><strong>max_retries</strong> (<em>int</em>) – Maximum number of retry attempts</p></li>
<li><p><strong>buffer_size</strong> (<em>int</em>) – Size of the WAL buffer in bytes</p></li>
<li><p><strong>blob_max_size</strong> (<em>int</em>) – Maximum size of a blob in bytes</p></li>
<li><p><strong>max_workers</strong> (<em>int</em>) – Number of worker threads for asynchronous operations</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterFileStorage.read_current_root">
<span class="sig-name descname"><span class="pre">read_current_root</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterFileStorage.read_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterFileStorage.read_current_root" title="Link to this definition"></a></dt>
<dd><p>Read the current root object.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The current root object pointer</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer">AtomPointer</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterFileStorage.read_lock_current_root">
<span class="sig-name descname"><span class="pre">read_lock_current_root</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterFileStorage.read_lock_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterFileStorage.read_lock_current_root" title="Link to this definition"></a></dt>
<dd><p>Read and lock the current root object.</p>
<p>This method acquires a distributed lock on the root object before reading it.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The current root object pointer</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer">AtomPointer</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterFileStorage.set_current_root">
<span class="sig-name descname"><span class="pre">set_current_root</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">root_pointer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterFileStorage.set_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterFileStorage.set_current_root" title="Link to this definition"></a></dt>
<dd><p>Set the current root object.</p>
<p>This method updates the root object and broadcasts the update to all servers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>root_pointer</strong> (<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a>) – The new root object pointer</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterFileStorage.unlock_current_root">
<span class="sig-name descname"><span class="pre">unlock_current_root</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterFileStorage.unlock_current_root"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterFileStorage.unlock_current_root" title="Link to this definition"></a></dt>
<dd><p>Unlock the current root object.</p>
<p>This method releases the distributed lock on the root object.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterFileStorage.get_reader">
<span class="sig-name descname"><span class="pre">get_reader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wal_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterFileStorage.get_reader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterFileStorage.get_reader" title="Link to this definition"></a></dt>
<dd><p>Get a reader for the specified WAL at the given position.</p>
<p>This method first tries to get the data from the local cache, then from the
local file system, and finally from other servers in the cluster.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wal_id</strong> (<em>UUID</em>) – WAL ID</p></li>
<li><p><strong>position</strong> (<em>int</em>) – Position in the WAL</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A reader for the WAL data</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>io.BytesIO</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterFileStorage.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterFileStorage.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterFileStorage.close" title="Link to this definition"></a></dt>
<dd><p>Close the storage, flushing any pending writes and releasing resources.</p>
<p>This method extends the base implementation to also stop the network manager.</p>
</dd></dl>

</dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">ClusterFileStorage</span></code> extends <code class="docutils literal notranslate"><span class="pre">StandaloneFileStorage</span></code> to provide distributed storage capabilities. It supports multiple nodes in a cluster, uses a vote-based locking mechanism for coordination, ensures consistency across nodes, and allows for horizontal scaling.</p>
<dl class="py class">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterNetworkManager">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.cluster_file_storage.</span></span><span class="sig-name descname"><span class="pre">ClusterNetworkManager</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">server_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">host</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">port</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">servers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vote_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_interval_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_retries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterNetworkManager"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterNetworkManager" title="Link to this definition"></a></dt>
<dd><p>Manages network communication between servers in the cluster.</p>
<p>This class handles sending and receiving messages between servers,
including vote requests/responses, page requests/responses, and root updates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>server_id</strong> (<em>str</em>)</p></li>
<li><p><strong>host</strong> (<em>str</em>)</p></li>
<li><p><strong>port</strong> (<em>int</em>)</p></li>
<li><p><strong>servers</strong> (<a class="reference internal" href="data_structures.html#proto_db.lists.List" title="proto_db.lists.List"><em>List</em></a><em>[</em><em>Tuple</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em><em>]</em>)</p></li>
<li><p><strong>vote_timeout_ms</strong> (<em>int</em>)</p></li>
<li><p><strong>read_timeout_ms</strong> (<em>int</em>)</p></li>
<li><p><strong>retry_interval_ms</strong> (<em>int</em>)</p></li>
<li><p><strong>max_retries</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterNetworkManager.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">server_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">host</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">port</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">servers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vote_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_interval_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_retries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterNetworkManager.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterNetworkManager.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize the network manager.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>server_id</strong> (<em>str</em>) – Unique identifier for this server</p></li>
<li><p><strong>host</strong> (<em>str</em>) – Host address to bind to</p></li>
<li><p><strong>port</strong> (<em>int</em>) – Port to listen on</p></li>
<li><p><strong>servers</strong> (<em>List</em><em>[</em><em>Tuple</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em><em>]</em>) – List of (host, port) tuples for all servers in the cluster</p></li>
<li><p><strong>vote_timeout_ms</strong> (<em>int</em>) – Timeout for vote requests in milliseconds</p></li>
<li><p><strong>read_timeout_ms</strong> (<em>int</em>) – Timeout for page requests in milliseconds</p></li>
<li><p><strong>retry_interval_ms</strong> (<em>int</em>) – Interval between retries in milliseconds</p></li>
<li><p><strong>max_retries</strong> (<em>int</em>) – Maximum number of retry attempts</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterNetworkManager.start">
<span class="sig-name descname"><span class="pre">start</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterNetworkManager.start"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterNetworkManager.start" title="Link to this definition"></a></dt>
<dd><p>Start the network manager.</p>
<p>This method starts the socket server and begins listening for incoming messages.
It also starts a cleanup thread for old requests.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterNetworkManager.stop">
<span class="sig-name descname"><span class="pre">stop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterNetworkManager.stop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterNetworkManager.stop" title="Link to this definition"></a></dt>
<dd><p>Stop the network manager.</p>
<p>This method stops the socket server and joins the listener and cleanup threads.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterNetworkManager.request_vote">
<span class="sig-name descname"><span class="pre">request_vote</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterNetworkManager.request_vote"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterNetworkManager.request_vote" title="Link to this definition"></a></dt>
<dd><p>Request votes from other servers to obtain exclusive lock.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>(success, votes_received)</dt><dd><p>success: True if majority of votes were received, False otherwise
votes_received: Number of positive votes received</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple[bool, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterNetworkManager.request_page">
<span class="sig-name descname"><span class="pre">request_page</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wal_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4096</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterNetworkManager.request_page"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterNetworkManager.request_page" title="Link to this definition"></a></dt>
<dd><p>Request a page from other servers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wal_id</strong> (<em>UUID</em>) – WAL ID</p></li>
<li><p><strong>offset</strong> (<em>int</em>) – Offset in the WAL</p></li>
<li><p><strong>size</strong> (<em>int</em>) – Size of the page to request</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The requested page data, or None if not found</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[bytes]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterNetworkManager.broadcast_root_update">
<span class="sig-name descname"><span class="pre">broadcast_root_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterNetworkManager.broadcast_root_update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterNetworkManager.broadcast_root_update" title="Link to this definition"></a></dt>
<dd><p>Broadcast a root update to all servers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transaction_id</strong> (<em>UUID</em>) – Transaction ID of the new root</p></li>
<li><p><strong>offset</strong> (<em>int</em>) – Offset of the new root</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Number of servers the update was successfully sent to</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cluster_file_storage.ClusterNetworkManager.send_heartbeat">
<span class="sig-name descname"><span class="pre">send_heartbeat</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cluster_file_storage.html#ClusterNetworkManager.send_heartbeat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cluster_file_storage.ClusterNetworkManager.send_heartbeat" title="Link to this definition"></a></dt>
<dd><p>Send a heartbeat to all servers.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Number of servers the heartbeat was successfully sent to</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>int</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">ClusterNetworkManager</span></code> class manages network communication between nodes in a cluster. It handles vote requests, page requests, and root object broadcasts.</p>
</section>
<section id="cloud-file-storage">
<h2>Cloud File Storage<a class="headerlink" href="#cloud-file-storage" title="Link to this heading"></a></h2>
<dl class="py class" id="module-proto_db.cloud_file_storage">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudFileStorage">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.cloud_file_storage.</span></span><span class="sig-name descname"><span class="pre">CloudFileStorage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block_provider</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">server_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">host</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">servers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vote_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_interval_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_retries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1048576</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blob_max_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2147483648</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">60</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upload_interval_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudFileStorage"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudFileStorage" title="Link to this definition"></a></dt>
<dd><p>An implementation of cloud file storage with support for S3-like object storage.</p>
<p>This class extends ClusterFileStorage to add support for storing data in an S3-like
object storage service, with local caching to improve performance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>block_provider</strong> (<a class="reference internal" href="#proto_db.cloud_file_storage.CloudBlockProvider" title="proto_db.cloud_file_storage.CloudBlockProvider"><em>CloudBlockProvider</em></a>)</p></li>
<li><p><strong>server_id</strong> (<em>str</em>)</p></li>
<li><p><strong>host</strong> (<em>str</em>)</p></li>
<li><p><strong>port</strong> (<em>int</em>)</p></li>
<li><p><strong>servers</strong> (<a class="reference internal" href="data_structures.html#proto_db.lists.List" title="proto_db.lists.List"><em>List</em></a><em>[</em><em>Tuple</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em><em>]</em>)</p></li>
<li><p><strong>vote_timeout_ms</strong> (<em>int</em>)</p></li>
<li><p><strong>read_timeout_ms</strong> (<em>int</em>)</p></li>
<li><p><strong>retry_interval_ms</strong> (<em>int</em>)</p></li>
<li><p><strong>max_retries</strong> (<em>int</em>)</p></li>
<li><p><strong>buffer_size</strong> (<em>int</em>)</p></li>
<li><p><strong>blob_max_size</strong> (<em>int</em>)</p></li>
<li><p><strong>max_workers</strong> (<em>int</em>)</p></li>
<li><p><strong>upload_interval_ms</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudFileStorage.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">block_provider</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">server_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">host</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">port</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">servers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vote_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_timeout_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_interval_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_retries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1048576</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blob_max_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2147483648</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">60</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upload_interval_ms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudFileStorage.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudFileStorage.__init__" title="Link to this definition"></a></dt>
<dd><p>Constructor for the CloudFileStorage class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>block_provider</strong> (<a class="reference internal" href="#proto_db.cloud_file_storage.CloudBlockProvider" title="proto_db.cloud_file_storage.CloudBlockProvider"><em>CloudBlockProvider</em></a>) – The underlying cloud block provider</p></li>
<li><p><strong>server_id</strong> (<em>str</em>) – Unique identifier for this server</p></li>
<li><p><strong>host</strong> (<em>str</em>) – Host address to bind to</p></li>
<li><p><strong>port</strong> (<em>int</em>) – Port to listen on</p></li>
<li><p><strong>servers</strong> (<em>List</em><em>[</em><em>Tuple</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em><em>]</em>) – List of (host, port) tuples for all servers in the cluster</p></li>
<li><p><strong>vote_timeout_ms</strong> (<em>int</em>) – Timeout for vote requests in milliseconds</p></li>
<li><p><strong>read_timeout_ms</strong> (<em>int</em>) – Timeout for page requests in milliseconds</p></li>
<li><p><strong>retry_interval_ms</strong> (<em>int</em>) – Interval between retries in milliseconds</p></li>
<li><p><strong>max_retries</strong> (<em>int</em>) – Maximum number of retry attempts</p></li>
<li><p><strong>buffer_size</strong> (<em>int</em>) – Size of the WAL buffer in bytes</p></li>
<li><p><strong>blob_max_size</strong> (<em>int</em>) – Maximum size of a blob in bytes</p></li>
<li><p><strong>max_workers</strong> (<em>int</em>) – Number of worker threads for asynchronous operations</p></li>
<li><p><strong>upload_interval_ms</strong> (<em>int</em>) – Interval between S3 uploads in milliseconds</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudFileStorage.flush_wal">
<span class="sig-name descname"><span class="pre">flush_wal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudFileStorage.flush_wal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudFileStorage.flush_wal" title="Link to this definition"></a></dt>
<dd><p>Public method to flush WAL buffer and process pending writes.</p>
<p>This method overrides the base implementation to also process pending uploads.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A tuple containing (bytes_flushed, operations_processed)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudFileStorage.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudFileStorage.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudFileStorage.close" title="Link to this definition"></a></dt>
<dd><p>Closes the storage, flushing any pending writes and releasing resources.</p>
<p>This method overrides the base implementation to also process pending uploads
before closing.</p>
</dd></dl>

</dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">CloudFileStorage</span></code> extends <code class="docutils literal notranslate"><span class="pre">ClusterFileStorage</span></code> to add support for cloud storage. It stores data in S3-compatible object storage, provides local caching for performance, supports background uploading of data, and is suitable for cloud-native applications.</p>
<dl class="py class">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudBlockProvider">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.cloud_file_storage.</span></span><span class="sig-name descname"><span class="pre">CloudBlockProvider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s3_client</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cloud_cache'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">524288000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5242880</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudBlockProvider"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudBlockProvider" title="Link to this definition"></a></dt>
<dd><p>Block provider implementation for cloud storage.</p>
<p>This class implements the BlockProvider interface for S3-compatible storage,
with local caching to improve performance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s3_client</strong> (<a class="reference internal" href="#proto_db.cloud_file_storage.S3Client" title="proto_db.cloud_file_storage.S3Client"><em>S3Client</em></a>)</p></li>
<li><p><strong>cache_dir</strong> (<em>str</em>)</p></li>
<li><p><strong>cache_size</strong> (<em>int</em>)</p></li>
<li><p><strong>object_size</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudBlockProvider.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s3_client</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cloud_cache'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">524288000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5242880</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudBlockProvider.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudBlockProvider.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize the cloud block provider.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s3_client</strong> (<a class="reference internal" href="#proto_db.cloud_file_storage.S3Client" title="proto_db.cloud_file_storage.S3Client"><em>S3Client</em></a>) – The S3 client to use</p></li>
<li><p><strong>cache_dir</strong> (<em>str</em>) – Directory for local cache</p></li>
<li><p><strong>cache_size</strong> (<em>int</em>) – Maximum size of local cache in bytes</p></li>
<li><p><strong>object_size</strong> (<em>int</em>) – Size of S3 objects in bytes</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudBlockProvider.get_config_data">
<span class="sig-name descname"><span class="pre">get_config_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudBlockProvider.get_config_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudBlockProvider.get_config_data" title="Link to this definition"></a></dt>
<dd><p>Get configuration data.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The configuration data</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudBlockProvider.get_new_wal">
<span class="sig-name descname"><span class="pre">get_new_wal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudBlockProvider.get_new_wal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudBlockProvider.get_new_wal" title="Link to this definition"></a></dt>
<dd><p>Get a WAL to use.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A tuple with the ID of the WAL and the next offset to use</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tuple[<em>UUID</em>, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudBlockProvider.get_reader">
<span class="sig-name descname"><span class="pre">get_reader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wal_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudBlockProvider.get_reader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudBlockProvider.get_reader" title="Link to this definition"></a></dt>
<dd><p>Get a reader for a WAL position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>wal_id</strong> (<em>UUID</em>) – The WAL ID</p></li>
<li><p><strong>position</strong> (<em>int</em>) – The position in the WAL</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A binary reader</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>BinaryIO</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudBlockProvider.get_writer_wal">
<span class="sig-name descname"><span class="pre">get_writer_wal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudBlockProvider.get_writer_wal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudBlockProvider.get_writer_wal" title="Link to this definition"></a></dt>
<dd><p>Get the current writer WAL ID.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The current writer WAL ID</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><em>UUID</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudBlockProvider.write_streamer">
<span class="sig-name descname"><span class="pre">write_streamer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wal_id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudBlockProvider.write_streamer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudBlockProvider.write_streamer" title="Link to this definition"></a></dt>
<dd><p>Get a writer for a WAL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>wal_id</strong> (<em>UUID</em>) – The WAL ID</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A file-like object for writing</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>FileIO</em></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudBlockProvider.get_current_root_object">
<span class="sig-name descname"><span class="pre">get_current_root_object</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudBlockProvider.get_current_root_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudBlockProvider.get_current_root_object" title="Link to this definition"></a></dt>
<dd><p>Read current root object from storage.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The current root object pointer</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudBlockProvider.update_root_object">
<span class="sig-name descname"><span class="pre">update_root_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_root</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudBlockProvider.update_root_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudBlockProvider.update_root_object" title="Link to this definition"></a></dt>
<dd><p>Updates or create the root object in storage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>new_root</strong> (<a class="reference internal" href="core.html#proto_db.common.AtomPointer" title="proto_db.common.AtomPointer"><em>AtomPointer</em></a>) – The new root object pointer</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudBlockProvider.close_wal">
<span class="sig-name descname"><span class="pre">close_wal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudBlockProvider.close_wal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudBlockProvider.close_wal" title="Link to this definition"></a></dt>
<dd><p>Close a WAL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>transaction_id</strong> (<em>UUID</em>) – The WAL ID</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudBlockProvider.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudBlockProvider.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudBlockProvider.close" title="Link to this definition"></a></dt>
<dd><p>Close the block provider.</p>
</dd></dl>

</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">CloudBlockProvider</span></code> class is a block provider implementation that uses S3-compatible object storage for storage. It is used by <code class="docutils literal notranslate"><span class="pre">CloudFileStorage</span></code> to read and write blocks.</p>
<dl class="py class">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.S3Client">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.cloud_file_storage.</span></span><span class="sig-name descname"><span class="pre">S3Client</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bucket</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">endpoint_url</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">access_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">secret_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#S3Client"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.S3Client" title="Link to this definition"></a></dt>
<dd><p>Abstract S3 client interface.</p>
<p>This class defines the interface for interacting with S3-compatible storage.
Concrete implementations should be provided for specific S3 providers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bucket</strong> (<em>str</em>)</p></li>
<li><p><strong>prefix</strong> (<em>str</em>)</p></li>
<li><p><strong>endpoint_url</strong> (<em>str</em>)</p></li>
<li><p><strong>access_key</strong> (<em>str</em>)</p></li>
<li><p><strong>secret_key</strong> (<em>str</em>)</p></li>
<li><p><strong>region</strong> (<em>str</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.S3Client.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bucket</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">endpoint_url</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">access_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">secret_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#S3Client.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.S3Client.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize the S3 client.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bucket</strong> (<em>str</em>) – The S3 bucket name</p></li>
<li><p><strong>prefix</strong> (<em>str</em>) – The prefix for all objects in the bucket</p></li>
<li><p><strong>endpoint_url</strong> (<em>str</em>) – The S3 endpoint URL</p></li>
<li><p><strong>access_key</strong> (<em>str</em>) – The S3 access key</p></li>
<li><p><strong>secret_key</strong> (<em>str</em>) – The S3 secret key</p></li>
<li><p><strong>region</strong> (<em>str</em>) – The S3 region</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.S3Client.get_object">
<span class="sig-name descname"><span class="pre">get_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#S3Client.get_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.S3Client.get_object" title="Link to this definition"></a></dt>
<dd><p>Get an object from S3.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – The object key</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple containing the object data and metadata</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Tuple</em>[bytes, <em>Dict</em>[str, <em>Any</em>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.S3Client.put_object">
<span class="sig-name descname"><span class="pre">put_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#S3Client.put_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.S3Client.put_object" title="Link to this definition"></a></dt>
<dd><p>Put an object to S3.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> (<em>str</em>) – The object key</p></li>
<li><p><strong>data</strong> (<em>bytes</em>) – The object data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Object metadata</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Dict</em>[str, <em>Any</em>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.S3Client.list_objects">
<span class="sig-name descname"><span class="pre">list_objects</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#S3Client.list_objects"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.S3Client.list_objects" title="Link to this definition"></a></dt>
<dd><p>List objects in S3.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>prefix</strong> (<em>str</em>) – The prefix to filter objects</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of object metadata</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>List</em>[<em>Dict</em>[str, <em>Any</em>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.S3Client.delete_object">
<span class="sig-name descname"><span class="pre">delete_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#S3Client.delete_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.S3Client.delete_object" title="Link to this definition"></a></dt>
<dd><p>Delete an object from S3.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – The object key</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the object was deleted, False otherwise</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">S3Client</span></code> interface defines the contract for S3 client implementations. It provides methods for getting, putting, listing, and deleting objects in S3-compatible storage.</p>
<dl class="py class">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.MockS3Client">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.cloud_file_storage.</span></span><span class="sig-name descname"><span class="pre">MockS3Client</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bucket</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">endpoint_url</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">access_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">secret_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#MockS3Client"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.MockS3Client" title="Link to this definition"></a></dt>
<dd><p>Mock implementation of S3Client for testing and development.</p>
<p>This implementation stores objects in memory and simulates S3 behavior.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bucket</strong> (<em>str</em>)</p></li>
<li><p><strong>prefix</strong> (<em>str</em>)</p></li>
<li><p><strong>endpoint_url</strong> (<em>str</em>)</p></li>
<li><p><strong>access_key</strong> (<em>str</em>)</p></li>
<li><p><strong>secret_key</strong> (<em>str</em>)</p></li>
<li><p><strong>region</strong> (<em>str</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.MockS3Client.get_object">
<span class="sig-name descname"><span class="pre">get_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#MockS3Client.get_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.MockS3Client.get_object" title="Link to this definition"></a></dt>
<dd><p>Get an object from the mock S3 storage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – The object key</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple containing the object data and metadata</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Tuple</em>[bytes, <em>Dict</em>[str, <em>Any</em>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.MockS3Client.put_object">
<span class="sig-name descname"><span class="pre">put_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#MockS3Client.put_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.MockS3Client.put_object" title="Link to this definition"></a></dt>
<dd><p>Put an object to the mock S3 storage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> (<em>str</em>) – The object key</p></li>
<li><p><strong>data</strong> (<em>bytes</em>) – The object data</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Object metadata</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Dict</em>[str, <em>Any</em>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.MockS3Client.list_objects">
<span class="sig-name descname"><span class="pre">list_objects</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#MockS3Client.list_objects"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.MockS3Client.list_objects" title="Link to this definition"></a></dt>
<dd><p>List objects in the mock S3 storage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>prefix</strong> (<em>str</em>) – The prefix to filter objects</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of object metadata</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>List</em>[<em>Dict</em>[str, <em>Any</em>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.MockS3Client.delete_object">
<span class="sig-name descname"><span class="pre">delete_object</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#MockS3Client.delete_object"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.MockS3Client.delete_object" title="Link to this definition"></a></dt>
<dd><p>Delete an object from the mock S3 storage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – The object key</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the object was deleted, False otherwise</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">MockS3Client</span></code> class is a mock implementation of the <code class="docutils literal notranslate"><span class="pre">S3Client</span></code> interface for testing and development. It simulates S3 behavior without requiring an actual S3 service.</p>
<dl class="py class">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.S3ObjectMetadata">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.cloud_file_storage.</span></span><span class="sig-name descname"><span class="pre">S3ObjectMetadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">etag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_modified</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_cached</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#S3ObjectMetadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.S3ObjectMetadata" title="Link to this definition"></a></dt>
<dd><p>Metadata for an S3 object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> (<em>str</em>)</p></li>
<li><p><strong>size</strong> (<em>int</em>)</p></li>
<li><p><strong>etag</strong> (<em>str</em>)</p></li>
<li><p><strong>last_modified</strong> (<em>float</em>)</p></li>
<li><p><strong>is_cached</strong> (<em>bool</em>)</p></li>
<li><p><strong>cache_path</strong> (<em>str</em>)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.S3ObjectMetadata.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">etag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">last_modified</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_cached</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#S3ObjectMetadata.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.S3ObjectMetadata.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize S3 object metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> (<em>str</em>) – The S3 object key</p></li>
<li><p><strong>size</strong> (<em>int</em>) – The size of the object in bytes</p></li>
<li><p><strong>etag</strong> (<em>str</em>) – The ETag of the object (usually MD5 hash)</p></li>
<li><p><strong>last_modified</strong> (<em>float</em>) – The last modified timestamp</p></li>
<li><p><strong>is_cached</strong> (<em>bool</em>) – Whether the object is cached locally</p></li>
<li><p><strong>cache_path</strong> (<em>str</em>) – Path to the local cache file</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">S3ObjectMetadata</span></code> class represents metadata for an S3 object. It includes the key, size, ETag, last modified timestamp, and caching information.</p>
<dl class="py class">
<dt class="sig sig-object py" id="proto_db.cloud_file_storage.CloudStorageError">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">proto_db.cloud_file_storage.</span></span><span class="sig-name descname"><span class="pre">CloudStorageError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">60000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exception_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/proto_db/cloud_file_storage.html#CloudStorageError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#proto_db.cloud_file_storage.CloudStorageError" title="Link to this definition"></a></dt>
<dd><p>Exception raised for cloud storage specific errors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>code</strong> (<em>int</em>)</p></li>
<li><p><strong>exception_type</strong> (<em>str</em>)</p></li>
<li><p><strong>message</strong> (<em>str</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>The <code class="docutils literal notranslate"><span class="pre">CloudStorageError</span></code> class is an exception raised for cloud storage specific errors.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="core.html" class="btn btn-neutral float-left" title="Core Components" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="data_structures.html" class="btn btn-neutral float-right" title="Data Structures" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ProtoBase Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>